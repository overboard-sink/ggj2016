<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demon Torch</title>
    <script type="text/javascript" src="/js/phaser.min.js"></script>
    <script type="text/javascript" src="/js/demon.js"></script>
    <style>
      body, html {
        margin: 0;
        padding: 0;
        background-color: #000000;
      }
    </style>
    <script type="text/javascript" src="/js/torch.js"></script>
    <script type="text/javascript" src="/js/symbol.js"></script>
    <script type="text/javascript" src="/js/particle-trail.js"></script>

  </head>
  <body>
    <main id="main"></main>
    <script type="text/javascript">


      var game = new Phaser.Game(640, 1120, Phaser.AUTO, 'main', {
        preload: preload,
        create: create,
        update: update
      });

      var demon;
      var symbol;
      var door;

      function preload() {
        Demon.preload(game);
        ParticleTrail.preload(game);
        Torch.preload(game);
        RitualSymbol.preload(game);
        game.load.image('door_vert', '/img/door_vert.png');
      }

      function create() {
        demon = new Demon(game, 20, 20);
        game.world.add(demon);

        symbol = new RitualSymbol(game, 1);

        door = game.add.sprite(80, 0, 'door_vert', 0);
        door.alpha = 0.5;
        door.open = false;
        game.physics.arcade.enable(door);
      }

      function update() {


        // touching torches
        game.physics.arcade.overlap(demon, symbol, function (a, b) {
          b.light();
        });

        if (symbol.isComplete()) {
          door.open = true;
          door.alpha = 1.0;
        }

        // exit room
        if (door.open) {
          game.physics.arcade.overlap(demon, door, function (a, b) {
            console.log('you left');
          });
        }
      }
    </script>
  </body>
</html>
